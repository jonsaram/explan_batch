<meta charset="utf-8">
<script type="text/javascript">
    var <@compId> = {
            userArr : []
           ,scheduleId : ''
           ,appMember      : {}
           ,orgStartTimeHour : ''
           ,orgStartTimeMinute : ''
           ,orgEndTimeHour : ''
           ,orgEndTimeMinute : ''
           ,loopTypeDtlVal : ''
           ,isEndDayOfMonth : false
           ,isLoopTypeMonth : false
           ,isLoopTypeQuarter : false
           ,isLoopTypeYear : false
           ,limitDate : ''
           ,IS_GOOGLE_CALENDAR_SYN_YN : false
           ,GOOGLE_CALENDAR_ID : ''
           ,SCHEDULE_ID : ''
           ,googleCalendarEventId : '' 
           ,init : function(data) {

               //************** 업무유형 **************
               
                // Code List 읽어오기
                var workTypeList = C_COM.getCodeList("SCHEDULE_WORK_TYPE");
                var singleboxList = { 
                     data           : workTypeList
                    ,targetId       : "<@compId>_selectBoxWorkType"
                }
                C_UICOM.makeSelectBox(singleboxList, "single");
                
               //============== 업무유형 ==============
             
               //************** 반복유형 **************
               var loopTypeList = C_COM.getCodeList("SCHEDULE_LOOP_TYPE");
               
               var loopTypeBoxList = { 
                    data           : loopTypeList
                   ,targetId       : "<@compId>_selectBoxLoopType"  
               }
               C_UICOM.makeSelectBox(loopTypeBoxList, "single");
               //============== 반복유형 ==============
                   
               //************** 공개여부 **************
               var secretYnList = C_COM.getCodeList("SCHEDULE_SECRET_YN");
               
               var secretYnBoxList = { 
                    data           : secretYnList
                   ,targetId       : "<@compId>_scheduleSecretYn" 
               }
               C_UICOM.makeSelectBox(secretYnBoxList, "single");
               
               //============== 공개여부 ==============
                   
               //************** 시작시간 **************
               var startTimeList = C_COM.getCodeList("TIME_HOUR_24");
               
               var startTimeBoxList = { 
                    data           : startTimeList
                   ,targetId       : "<@compId>_selectBoxStartTime" 
               }

               C_UICOM.makeSelectBox(startTimeBoxList, "single");
               
               //============== 시작시간 ==============
               
               //************** 시작분 **************
               var startMinuteList = C_COM.getCodeList("TIME_MINUTE_30");
               
               var startMinutBoxList = { 
                    data           : startMinuteList
                   ,targetId       : "<@compId>_selectBoxStartMinute" 
               }

               C_UICOM.makeSelectBox(startMinutBoxList, "single");
               
               //============== 시작시간 ==============
                   
               //************** 종료시간 **************
               var endTimeList = C_COM.getCodeList("TIME_HOUR_24");
               
               var endTimeBoxList = { 
                    data           : endTimeList
                   ,targetId       : "<@compId>_selectBoxEndTime" 
               }

               C_UICOM.makeSelectBox(endTimeBoxList, "single");

               //============== 종료시간 ==============
                   
               //************** 종료분 **************
               var endMinuteList = C_COM.getCodeList("TIME_MINUTE_30");
               
               var endMinutBoxList = { 
                    data           : endMinuteList
                   ,targetId       : "<@compId>_selectBoxEndMinute" 
               }

               C_UICOM.makeSelectBox(endMinutBoxList, "single");

               
               $("#<@compId>_allDay").change(function(){
                   if($("#<@compId>_allDay").is(":checked")){
                       <@compId>.setSelectBoxTime( "00", "00", "23", "30" );
                       <@compId>.timeType = 'ALL';
                   }else{  
                       <@compId>.setSelectBoxTime( <@compId>.orgStartTimeHour, <@compId>.orgStartTimeMinute, <@compId>.orgEndTimeHour, <@compId>.orgEndTimeMinute );
                   }
               });  
               
               <@compId>.getUserInfo();
           }

           /*=============================================================================================*/
           /* ChangeListener    ChangeListener    ChangeListener    ChangeListener    ChangeListener      */
           ,changeWorkType : function() {
               alert("changeWorkType");
               var selectElement = document.getElementById("<@compId>_selectBoxWorkType");
               <@compId>.workType = selectElement.value;
            }
           ,changeLoopType : function() {
               alert("changeLoopType");
               var selectElement = document.getElementById("<@compId>_selectBoxLoopType");
               <@compId>.loopType = selectElement.value;
               
               if ( <@compId>.loopType == 'NOT_REPEAT') {
                   $("#<@compId>_showLimitDate").hide();
                   
               }else{

                   $("#<@compId>_showLimitDate").show();
                   
                   let setDate = <@compId>.getLimitDate( <@compId>.loopType, $('#<@compId>_dateStart').val() );
                   <@compId>.limitDate = setDate;
                   $('#<@compId>_loopLimitDate').val(setDate);
                   
                   //월의 마지막 일자 세팅
                   <@compId>.setEndDayOfMonth();
               }
            }
           ,changeSecretYn : function() {
               alert("changeSecretYn");
               var selectElement = document.getElementById("<@compId>_scheduleSecretYn");
               <@compId>.secretYn = selectElement.value;
               
            }
           ,changeStartTime : function() {
               alert("changeStartTime");
               var selectElement = document.getElementById("<@compId>_selectBoxStartTime");
               <@compId>.startTimeH = selectElement.value;
                //종료시간 세팅
               <@compId>.setEndTime(<@compId>.startTimeH);
            }

           ,changeStartMinute : function() {
               alert("changeStartMinute");
               var selectElement = document.getElementById("<@compId>_selectBoxStartMinute");
               <@compId>.startTimeM = selectElement.value;
            }

           ,changeEndTime : function() {
               alert("changeEndTime");
               var selectElement = document.getElementById("<@compId>_selectBoxEndTime");
               <@compId>.endTimeH = selectElement.value;
                
            }

           ,changeEndMinute : function() {
               alert("changeEndMinute");
               var selectElement = document.getElementById("<@compId>_selectBoxEndMinute");
               <@compId>.endTimeM = selectElement.value;
            }
           /* ChangeListener    ChangeListener    ChangeListener    ChangeListener    ChangeListener      */
           /*=============================================================================================*/
           
           ,getUserInfo : () =>  {
               let requestParm = {};
               let USER_ID = G_VAL.session.USER_ID;
               
               let parm = {
                    queryId        : "schedule.getUserInfo"
                   ,requestParm    : requestParm
               }
                
               C_COM.requestQuery(parm, function(resultData) {
                   for(var i =0; i < resultData.data.length; i++){
                       if( resultData.data[i] != null){
                           <@compId>.GOOGLE_CALENDAR_ID = resultData.data[i].GOOGLE_CALENDAR_ID;
                           if( resultData.data[i].GOOGLE_CALENDAR_SYN_YN == "Y"){
                               <@compId>.IS_GOOGLE_CALENDAR_SYN_YN = true;
                               // 구글 관련 
                               <@compId>.gapiLoaded();
                               <@compId>.gisLoaded();
                           }else{
                               <@compId>.IS_GOOGLE_CALENDAR_SYN_YN = false;
                           }  
                       }
                   }
                });
               
            }

           /*================================================ 참석자 관련    참석자 관련    ================================================*/
           ,getAppMemberToList : function() {
               let resultList = []
               $.each(<@compId>.appMember, function(key, obj) {
                   resultList.push(obj);
               });
               return resultList;
            }
           ,loadAppMember : function() {
               let mlst = <@compId>.getAppMemberToList();
               
               // 참석자 표시
               let rparm = {
                    targetId : "scheduleMember"
                   ,list     : mlst
               }
               C_COM.renderHtml("<@compId>", rparm);
            }
           ,memberSearchPopup : function() {
       
               C_POP.open('popup_userSearchPopup', {}, function(retData) {
                   if(!(typeof retData == "undefined" || retData == null || retData == "")){
                       <@compId>.addMember(retData);
                   }
               });
            }
           ,addMember : function(retData) {

               if(isValid(<@compId>.appMember[retData.USER_ID])) {
                   C_POP.alert('이미 등록되어 있는 사원입니다.');
                   return;
               }
               <@compId>.appMember[retData.USER_ID] = retData;
               
               <@compId>.loadAppMember();
            }
           ,delMember : function(userId) {/* 참석자 삭제 */
               <@compId>.appMember = removeMember(<@compId>.appMember, userId);
               <@compId>.loadAppMember();
            }
           
           ,deleteUser : function(num) {/* 참석자 삭제 */
               $("#<@compId> #approvalUser" + num).remove();
               <@compId>.userArr[num].is_delete = true;
            }
           /*################################################ 참석자 관련    참석자 관련    ################################################*/
           
        ,setSelectBoxTime : function( startTimeHour, startTimeMinute, endTimeHour, endTimeMinute ) {
            
            C_UICOM.setSingleBox("<@compId>_selectBoxStartTime", startTimeHour);
            C_UICOM.setSingleBox("<@compId>_selectBoxStartMinute", startTimeMinute);
            C_UICOM.setSingleBox("<@compId>_selectBoxEndTime", endTimeHour);
            C_UICOM.setSingleBox("<@compId>_selectBoxEndMinute", endTimeMinute);
        }

        ,getLimitDate : function( loopType,dateStart ) {
            
            let result = "";
            let newDate   = new Date(dateStart);
            
            if("NOT_REPEAT" == loopType ){
                result = dateStart;
            }else if("DAY" == loopType ){
                newDate.setFullYear(newDate.getFullYear());
                newDate.setMonth(newDate.getMonth());
                newDate.setDate(newDate.getDate() + 30 );
            }else if("WEEK" == loopType ){
                newDate.setFullYear(newDate.getFullYear());
                newDate.setMonth(newDate.getMonth());
                newDate.setDate(newDate.getDate() + 28 );
            }else if("MONTH" == loopType ){
                newDate.setFullYear(newDate.getFullYear());
                newDate.setMonth(newDate.getMonth() + 12);
                newDate.setDate(newDate.getDate());
            }else if("QUARTER" == loopType ){
                newDate.setFullYear(newDate.getFullYear());
                newDate.setMonth(newDate.getMonth() + 12);
                newDate.setDate(newDate.getDate());
            }else if("YEAR" == loopType ){
                newDate.setFullYear(newDate.getFullYear() + 4);
                newDate.setMonth(newDate.getMonth());
                newDate.setDate(newDate.getDate());
            }else{}
            
            const year = newDate.getFullYear();
            const month = ('0' + (newDate.getMonth() + 1)).slice(-2);
            const day = ('0' + newDate.getDate()).slice(-2);
            result = `${year}-${month}-${day}`;
            
            return result;
                        
         }
        /* 위성열 / 프로젝트 선택 */
        ,selectProjectPop : function() {
            C_POP.open('popup_operation_projectSearchPopup', {}, function(retData) {
                if(isValid(retData)) {
                    let projectNm = `${retData.BUYER_NM}/${retData.CONSULTING_NM}`;
                    $("#<@compId>_contractId").val(retData.CONTRACT_ID);
                    $("#<@compId>_contractNm").val(projectNm);
                }
            });
         }

        ,searchSchedule : function(scheduleId) {
            
            let requestParm = {};
            requestParm["scheduleId"]  = scheduleId;
            let parm = {
                 queryId        : "schedule.getScheduleList"
                ,requestParm    : requestParm
            }
            C_COM.requestQuery(parm, function(resultData) {
                <@compId>.setSchedule(resultData.data[0]);
                <@compId>.searchScheduleMember(scheduleId);
                <@compId>.showHideEndDayOfMonth();
            });
            
         }
        /* 일정의 시작일과 반복주기 선택이 변경될때 호출*/
        ,showHideEndDayOfMonth : function() {
           

            var dateStart = $('#<@compId>_dateStart').val();
            
            let lastDate = new Date(Number(dateStart.substr(0, 4)), Number(dateStart.substr(5, 2)), 0);//월의 마지막일
            if ( Number(dateStart.substr(8, 2)) == lastDate.getDate() ) {//시작일이 선택월의 마지막날인가
                <@compId>.isEndDayOfMonth = true;
            }
            
           var loopType = C_UICOM.getData("<@compId>_selectBoxLoopType");
           
           if ( loopType == 'MONTH' ) {//시작일이 선택월의 마지막날인가
               <@compId>.isLoopTypeMonth = true;
           }else{
               <@compId>.isLoopTypeMonth = false;
           }

           if ( loopType == 'QUARTER' ) {//시작일이 선택월의 마지막날인가
               <@compId>.isLoopTypeQuarter = true;
           }else{
               <@compId>.isLoopTypeQuarter = false;
           }
           
           if ( loopType == 'YEAR' ) {//시작일이 선택월의 마지막날인가
               <@compId>.isLoopTypeYear = true;
           }else{
               <@compId>.isLoopTypeYear = false;
           }
           /* */
           if ( (<@compId>.isEndDayOfMonth && <@compId>.isLoopTypeMonth) || 
                (<@compId>.isEndDayOfMonth && <@compId>.isLoopTypeYear) ||
                (<@compId>.isEndDayOfMonth && <@compId>.isLoopTypeQuarter)
              ) {
               $("#<@compId>_showLoopTypeDtl").show();
           }else{
               $("#<@compId>_showLoopTypeDtl").hide();
           }
          
        }
        ,setSchedule : function( data ) {
            
            $('#<@compId>_title').val(data.TITLE);
            $('#<@compId>_position').val(data.POSITION);
            $('#<@compId>_description').val(data.DESCRIPTION);
            $('#<@compId>_orgDateStart').val(data.SCHEDULE_DATE1);
            $('#<@compId>_dateStart').val(data.SCHEDULE_START_DATE);
            $('#<@compId>_dateEnd').val(data.SCHEDULE_END_DATE);
            $('#<@compId>_contractId').val(data.CONTRACT_ID);
            $('#<@compId>_contractNm').val(data.CONTRACT_NM);
            $('#<@compId>_loopLimitDate').val(data.SCHEDULE_LOOP_END_DATE);
            <@compId>.googleCalendarEventId   = data.GOOGLE_CALENDAR_EVENT_ID;
            
            // 셀렉트 박스 세팅
            C_UICOM.setSingleBox("<@compId>_selectBoxLoopType", data.LOOP_TYPE);
            C_UICOM.setSingleBox("<@compId>_selectBoxWorkType", data.WORK_TYPE);
            C_UICOM.setSingleBox("<@compId>_scheduleSecretYn", data.SECRET_YN);
            
            // 종일 선택 체크박스 선택시 원래 데이타 복원 
            <@compId>.orgStartTimeHour   = data.START_TIME_HOUR;
            <@compId>.orgStartTimeMinute = data.START_TIME_MINUTE;
            <@compId>.orgEndTimeHour     = data.END_TIME_HOUR;
            <@compId>.orgEndTimeMinute   = data.END_TIME_MINUTE;
            <@compId>.setSelectBoxTime(data.START_TIME_HOUR, data.START_TIME_MINUTE, data.END_TIME_HOUR, data.END_TIME_MINUTE);
            
            var loopTypeDtlCd  = data.LOOP_TYPE_DTL_CD       
            var loopTypeDtlVal = data.LOOP_TYPE_DTL_VAL
            
            if(loopTypeDtlCd){
                 <@compId>.setSelectBoxLoopTypeDtl(loopTypeDtlCd, loopTypeDtlVal,data.SCHEDULE_START_DATE);
            }
        }

        ,setSelectBoxLoopTypeDtl : function( loopTypeDtlCd, loopTypeDtlVal, startDate) {            
            
            var selectDay = "";
            var startDay = startDate.substring(8, 10);
            
            if(loopTypeDtlCd == "SELECT_DAY"){
                if(loopTypeDtlVal){
                    selectDay = loopTypeDtlVal;
                }else{
                    selectDay = startDay;
                }
            }else if(loopTypeDtlCd == "END_OF_MONTH"){
                selectDay = startDay;
            }else{}
            //************** 반복상세 **************
            var loopTypeList = [
                  ['SELECT_DAY', selectDay+'일 마다 반복']
                , ['END_OF_MONTH', '매월 마지막 날 반복']
              ];
            
            var loopTypeDtlBoxList = { 
                 data           : loopTypeList
                ,targetId       : "<@compId>_selectBoxLoopTypeDtl"  
            }
            C_UICOM.makeSelectBox(loopTypeDtlBoxList, "single");
            C_UICOM.setSingleBox("<@compId>_selectBoxLoopTypeDtl", loopTypeDtlCd);//초기값 세팅

            <@compId>.loopTypeDtlVal = selectDay;
            C_UICOM.addChangeListener("<@compId>_selectBoxLoopTypeDtl", function(dataObj) {
                
                if( dataObj == 'SELECT_DAY'){
                    <@compId>.loopTypeDtlVal = selectDay;
                }else{
                    <@compId>.loopTypeDtlVal = '';
                }
            });
            //============== 반복유형 ==============
         }
        ,searchScheduleMember : function(scheduleId) {
            
            let requestParm = {};
            requestParm["scheduleId"]  = scheduleId;
            /* 참석자 조회*/
            let parmDtl = {
                 queryId        : "schedule.getScheduleShareList"
                ,requestParm    : requestParm
            }
            C_COM.requestQuery(parmDtl, function(resultData) {
                for(var i =0; i <resultData.data.length; i++){
                    <@compId>.addMember(resultData.data[i]);
                }
            });
        }
        ,delete : function() {
            
            
            let requestParm = {};            
            requestParm["scheduleId"]         = <@compId>.scheduleId;
            requestParm["userId"]             = G_VAL.session.USER_ID ;
            requestParm["spCstmId"]           = G_VAL.session.spCstmId ;
            
            // 데이타 삭제
            var parm = {
                 serviceId              : "ScheduleService.deleteSchedule"
                ,requestParm            : requestParm
            }
            C_COM.requestService(parm, function(resultData) {
                
                if("S" == resultData.data.state){
                    C_POP.alert("일정이 삭제에 성공하였습니다.");
                    var obj = new Object();
                    obj.refresh = 'Y';
                     
                    C_POP.close(obj);
                }else{
                    C_POP.alert("일정이 삭제에 실패하였습니다.");
                }
                
            });
            
        }
        ,save : function() {
            
            var loopType = C_UICOM.getData("<@compId>_selectBoxLoopType");
                        
            if( <@compId>.saveCheck(loopType) ){
                return;
            }

            let contractId = $('#<@compId>_contractId').val();
            let contractNm = $('#<@compId>_contractNm').val();
            
            let requestParm = {};            
            requestParm["scheduleId"]         = <@compId>.scheduleId;
            requestParm["title"]              = $('#<@compId>_title').val();
            requestParm["orgDateStart"]       = $('#<@compId>_orgDateStart').val();
            requestParm["scheduleStartDate"]  = $('#<@compId>_dateStart').val();
            requestParm["scheduleEndDate"]    = $('#<@compId>_dateEnd').val();
            requestParm["position"]           = $('#<@compId>_position').val();
            requestParm["description"]        = $('#<@compId>_description').val();
            requestParm["loopType"]           = loopType;
            requestParm["workType"]           = C_UICOM.getData("<@compId>_selectBoxWorkType");
            requestParm["startTimeH"]         = C_UICOM.getData("<@compId>_selectBoxStartTime");
            requestParm["startTimeM"]         = C_UICOM.getData("<@compId>_selectBoxStartMinute");
            requestParm["endTimeH"]           = C_UICOM.getData("<@compId>_selectBoxEndTime");
            requestParm["endTimeM"]           = C_UICOM.getData("<@compId>_selectBoxEndMinute");
            requestParm["secretYn"]           = C_UICOM.getData("<@compId>_scheduleSecretYn");

            if( "" == contractNm ){ 
                requestParm["contractId"] = "";
            }else { 
                requestParm["contractId"] = $('#<@compId>_contractId').val(); 
            }

            // 반복안함선택시 종료일 제한은 일정 종료일로 세팅
            if("NOT_REPEAT" == loopType ){
                requestParm["loopLimitDate"] = $('#<@compId>_dateEnd').val();
            }else{
                requestParm["loopLimitDate"] = $('#<@compId>_loopLimitDate').val();
            }
            
            if ( (<@compId>.isEndDayOfMonth)
               ) {//시작일이 선택월의 마지막날인가
                requestParm["loopTypeDtlCd"]      = C_UICOM.getData("<@compId>_selectBoxLoopTypeDtl");
                requestParm["loopTypeDtlVal"]     = <@compId>.loopTypeDtlVal;
            }else{
                requestParm["loopTypeDtlCd"]      = '';
                requestParm["loopTypeDtlVal"]     = '';    
            }
                
            // 데이타 저장
            var parm = {
                 serviceId              : "ScheduleService.updateSchedule"
                ,requestParm            : requestParm
            }
            C_COM.requestService(parm, function(resultData) {

                if("S" == resultData.state){
                    
                    if( <@compId>.IS_GOOGLE_CALENDAR_SYN_YN ){
                        <@compId>.saveGoogleEvent( requestParm );// 구글저장
                    }else{
                        var obj = new Object();
                        obj.refresh = 'Y';
                        C_POP.close(obj);   
                    }
                }else{
                    C_POP.alert("일정이 수정에 실패하였습니다.");
                }
                
                
            });
        }
        ,saveCheck : function( loopType ) {
            
            if ($('#<@compId>_title').val().length < 1) {
                C_POP.alert("제목을 입력해 주세요.");
                $("#<@compId>_title").focus();
                return true;
            }
            
            if ($('#<@compId>_dateStart').val().length < 1) {
                C_POP.alert("일정을 입력해 주세요.");
                $("#<@compId>_dateStart").focus();
                return true;
            }

            if( Number($('#<@compId>_dateStart').val().replace(/-/gi,"")) > Number($('#<@compId>_dateEnd').val().replace(/-/gi,"")) ){
                C_POP.alert("시작일이 종료일보다 클 수 없습니다.");
                $("#<@compId>_dateStart").focus();
                return true;
            }
            
            if( Number($('#<@compId>_dateStart').val().replace(/-/gi,"")) < Number(<@compId>.today.replace(/-/gi,"")) ){
                C_POP.alert("시작일이 현재일보다 작을 수 없습니다.");
                $("#<@compId>_dateStart").focus();
                return true;
            }

            if( Number($('#<@compId>_dateStart').val().replace(/-/gi,"")) < Number(<@compId>.today.replace(/-/gi,"")) ){
                C_POP.alert("시작일이 현재일보다 작을 수 없습니다.");
                $("#<@compId>_dateStart").focus();
                return true;
            }
            
            var startTimeH = C_UICOM.getData("<@compId>_selectBoxStartTime");
            var startTimeM = C_UICOM.getData("<@compId>_selectBoxStartMinute");
            var endTimeH   = C_UICOM.getData("<@compId>_selectBoxEndTime");
            var endTimeM   = C_UICOM.getData("<@compId>_selectBoxEndMinute");
            
            let startHM = startTimeH + startTimeM;
            let endHM   = endTimeH + endTimeM;
            
            if( Number(startHM.replace(/-/gi,"")) > Number(endHM.replace(/-/gi,"")) ){
                C_POP.alert("시작시간이 종료시간보다 클 수 없습니다.");
                return true;
            }

            var dateStart  = $('#<@compId>_dateStart').val();
            var dateEnd   = $('#<@compId>_dateEnd').val();

            if( dateStart == dateEnd ){
                if( startHM == endHM ){
                    C_POP.alert("일정 시작일시와 종료일시가 같습니다.");
                    return true;
                }
            }

            let startDay = $('#<@compId>_dateStart').val();
            let endDay   = $('#<@compId>_dateEnd').val();
            
            const startDate = new Date(startDay);
            const endDate   = new Date(endDay);
            const diffDate = endDate.getTime() - startDate.getTime();
            const dayCnt = Math.abs(diffDate / (1000 * 60 * 60 * 24)); // 밀리세컨 * 초 * 분 * 시 = 일
            
            if( "DAY" == loopType ){
                if( startDay != endDay){
                    C_POP.alert("매일 반복은 일정 시작일과 종료일이 같아야 합니다.");
                    return true;
                }
            }else{
                if( 5 < dayCnt){
                    C_POP.alert("일정 시작일과 종료일 기간은 5일을 넘길 수 없습니다.");
                    return true;
                }
            }            
            return false;
        }
         //종료시간 세팅
        ,setEndTime : function(timeHour) {
            
            let dateStart = $('#<@compId>_dateStart').val();
            let dateEnd   = $('#<@compId>_dateEnd').val();
            
            if( dateStart != dateEnd){
                return;
            }
            
            var endHour ;
            if( timeHour == "23"){ endHour = "00";}
            else{
                var numTimeHour = Number(timeHour);
                var numEndHour = numTimeHour +1 ;
                endHour = String(numEndHour).padStart(2, "0");
            }
            
            C_UICOM.setSingleBox("<@compId>_selectBoxEndTime", endHour);
        }

        /*=============================================================================================*/
        /* google API함수    google API함수    google API함수    google API함수    google API함수       */
        
        ,gapiLoaded : function() {
             gapi.load('client', () => {
                 <@compId>.initializeGapiClient()
                     .then(() => {
                     })
                     .catch(error => {
                         console.error('Error loading GAPI client:', error);
                     });
             });
         }

        ,gisLoaded : function() {
            <@compId>.TOKEN_CLIENT = google.accounts.oauth2.initTokenClient({
            client_id: _CLIENT_ID,
            scope: _SCOPES,
            callback: (response) => {
                console.log('GAPI OAuth2 token client initialized successfully.');
                // 추가 작업
            }
          });
        }
        ,initializeGapiClient: async function() {
            try {
                await gapi.client.init({
                    apiKey: _API_KEY,
                    discoveryDocs: _DISCOVERY_DOCS
                });
            } catch (error) {
                console.error('Error initializing GAPI client:', error);
            }
        }
        ,saveGoogleEvent : function( requestParm ) {
            <@compId>.TOKEN_CLIENT.callback = async (resp) => {
              if (resp.error !== undefined) {
                throw (resp);
              }
              <@compId>.updateEventAPI( requestParm );
            };
            if (gapi.client.getToken() === null) {
              // Prompt the user to select an account.
              <@compId>.TOKEN_CLIENT.requestAccessToken({prompt: 'consent'});
            } else {
              // Skip display of account chooser.
              <@compId>.TOKEN_CLIENT.requestAccessToken({prompt: ''});
            }
         }

        ,updateEventAPI : function( requestParm ) {
            let saveEvents = [];
            let is_save    = false;
            // 비동기 요청을 저장할 배열
            let promises = [];

            var summary       = requestParm["title"];
            var location      = requestParm["position"];
            var description   = requestParm["description"];            
            var startD        = requestParm["scheduleStartDate"];
            var startH        = requestParm["startTimeH"];
            var startM        = requestParm["startTimeM"];
            var startDateTime = startD+'T'+startH+':'+startM+':00';            
            var endD          = requestParm["scheduleEndDate"];
            var endH          = requestParm["endTimeH"];
            var endM          = requestParm["endTimeM"];
            var endDateTime   = endD+'T'+endH+':'+endM+':00';
            
            const event = {
                'summary': summary,
                'location': location,
                'description': description,
                'start': {
                    'dateTime': startDateTime,
                    'timeZone': 'Asia/Seoul'
                },
                'end': {
                    'dateTime': endDateTime, 
                    'timeZone': 'Asia/Seoul'
                }
            };
            
            gapi.client.calendar.events.update({
              'calendarId': <@compId>.GOOGLE_CALENDAR_ID,
              'eventId': <@compId>.googleCalendarEventId,
              'resource': event
            }).then(function(response) {

              var obj = new Object();
              obj.refresh = 'Y';
              C_POP.close(obj);
              console.log('Event updated: ' + response.result.htmlLink);
            }).catch(function(error) {
              C_POP.alert("일정이 수정에 실패하였습니다.");
              console.error('Error updating event: ' + error);
            });
            

            
         }//updateEventAPI
        /* google API함수    google API함수    google API함수    google API함수    google API함수       */
        /*=============================================================================================*/
    }
    // Popup Load가 완료된후 실행 된다.
    C_COMP.onLoadComp("<@compId>", function(data) {

        <@compId>.today = data["today"];
        <@compId>.scheduleId = data["scheduleId"];
        
        <@compId>.init(data);// 초기화

        <@compId>.searchSchedule(<@compId>.scheduleId);// 조회
    });
</script>
<component>
  <div class="modal-body explan-table-allwrap explan-mxhgt500">
    <table class="col10">
      <colgroup>
        <col>
        <col>
      </colgroup>
      <tbody>
        <tr>
          <th class="col3 col3-sm col10-xs">제목11</th>
          <td class="col7 col7-sm col10-xs"><input type="text" id="<@compId>_title"  class="form-control form-control-sm col10" ></td>
        </tr>
        <tr>
          <th>업무 유형</th>
          <td class="col7 col7-sm col10-xs">
            <select class="form-control form-control-sm col3" id="<@compId>_selectBoxWorkType" ></select>   
          </td>
        </tr>
        <tr>
          <th>일정</th>
          <td style="display: flex; flex-direction: row; justify-content: space-between;">
            <input id="<@compId>_dateStart" type="date" onchange="<@compId>.setEndDayOfMonth();"class="form-control form-control-sm col3 calender-form">
            ~
            <input id="<@compId>_dateEnd" type="date" class="form-control form-control-sm col3 calender-form">
            <select class="form-control form-control-sm col3" id="<@compId>_selectBoxLoopType" onChange="<@compId>.changeLoopType(this.value)"></select>               
          </td>
        </tr>
        
        <tr id="<@compId>_showLoopTypeDtl" style="display:none;">
          <th>월반복</th>
          <td class="col7 col7-sm col10-xs">
            <select class="form-control form-control-sm col3" id="<@compId>_selectBoxLoopTypeDtl" onChange="<@compId>.changeLoopTypeDtl(this.value)"></select>
          </td>
        </tr>
        
        <tr id="<@compId>_showLimitDate" style="display:none;">
          <th>반복종료</th>
          <td class="col7 col7-sm col10-xs">
            <input type="date" id="<@compId>_loopLimitDate"  class="form-control form-control-sm col3 calender-form">    
          </td>
        </tr>
        <tr>
          <th>시간</th>
          <td style="display: flex; flex-direction: row; justify-content: space-between;">
            <select id="<@compId>_selectBoxStartTime"  class="form-control form-control-sm col2 mr5"></select>
            <select  id="<@compId>_selectBoxStartMinute"  class="form-control form-control-sm col2 mr5"></select>
            <span class="mr5">~</span>
            <select id="<@compId>_selectBoxEndTime" class="form-control form-control-sm col2 mr5"></select>
            <select id="<@compId>_selectBoxEndMinute" class="form-control form-control-sm col2 mr10"></select>
            <span class="col2 ml-10 mt5"><input type="checkbox"> 종일</span>
          </td>
        </tr>
        <tr>
          <th>위치</th>
          <td><input id="<@compId>_position"  type="text" class="form-control form-control-sm col10"></td>
        </tr>
        <tr>
          <th>프로젝트</th>
          <td>
              <input type="hidden" id="<@compId>_contractId"> 
              <input id="<@compId>_contractNm" type="text" class="form-control form-control-sm col10 search-form" onClickRightIcon="<@compId>.selectProjectPop(this.value)">
          </td>
        </tr> 
        <tr>
          <th>공개 여부</th>
          <td>
            <select id="<@compId>_scheduleSecretYn" class="form-control form-control-sm col3"></select>
          </td>
        </tr>
        <tr>
          <th>설명 추가</th>
          <td><textarea id="<@compId>_description" name="" rows="6" cols="" class="msg-cnt-textarea col10 msg-cnt" placeholder="설명 추가"></textarea></td>
        </tr>                                                                                                          
      </tbody>
    </table>
  </div>

</component>
