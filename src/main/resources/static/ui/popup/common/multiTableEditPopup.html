<meta charset="utf-8">
<script type="text/javascript">
	var <@popupId> = {
		 currentSelectDataFst : {}	
		,sendParm			  : {}
		,preConnectKey		  : ""
		,close : function(returnData) {
			if(isEmpty(returnData)) returnData = {};
			C_POP.close(returnData);
		 }
		,maxSize : function() {
			C_POP.maxSize('<@popupId>');		
		 }
		,normalSize : function() {
			C_POP.normalSize('<@popupId>');		
		 }
		,saveFst	: function() {
			C_POP.confirm('저장하시겠습니까?', function() {
				<@popupId>["tableEditorPopupFst"].save(function(returnData) {
					C_POP.alert('저장되었습니다.');
					<@popupId>.reloadFst();
				});
			});
		 }
		,saveSnd	: function() {
			C_POP.confirm('저장하시겠습니까?', function() {
				<@popupId>["tableEditorPopupSnd"].save(function(returnData) {
					C_POP.alert('저장되었습니다.');
					<@popupId>.reloadSnd();
				});
			});
		 }
		,reloadFst 	: function() {
			let searchValue = $("#<@popupId> #searchValueFst").val();
			<@popupId>["tableEditorPopupFst"].reload({ searchValue : searchValue });
		 }
		,reloadSnd 	: function() {
			let searchValue = $("#<@popupId> #searchValueSnd").val();
			<@popupId>["tableEditorPopupSnd"].reload({ searchValue : searchValue });
		 }
		,onClickRowFst : function(data) {
			
			let sendParm		= <@popupId>.sendParm;
			let connectColumn	= sendParm.connectColumn;

			let connectMapping	= sendParm.connectMapping;
			if(isEmpty(connectMapping)) connectMapping = {};
			
			let searchWhereMap 		= sendParm.gridParmSnd.searchWhereMap		;
			let defaultSetColumnMap = sendParm.gridParmSnd.defaultSetColumnMap	;

			let emptyCheck = false;
			let connectKey = "";
			$.each(connectColumn, function(idx) {
				let fstColumnId = "" + this;
				// 기본 연계 Column명은 동일함.
				let sndColumnId = fstColumnId;
				// 다를경우 connectMapping으로 컬럼명을 전달 받음
				if(isValid(connectMapping[fstColumnId])) sndColumnId = connectMapping[fstColumnId] 

				if(isEmpty(data[fstColumnId]	)) emptyCheck = true;
				if(isValid(searchWhereMap		)) searchWhereMap		[sndColumnId] = data[fstColumnId];
				if(isValid(defaultSetColumnMap	)) defaultSetColumnMap	[sndColumnId] = data[fstColumnId];
				connectKey += data[fstColumnId];
			});
			if(emptyCheck								) return;
			if(<@popupId>.preConnectKey == connectKey	) return;
			<@popupId>.preConnectKey = connectKey;
			
			let updateParm = { 
				 searchWhereMap 	: searchWhereMap
				,defaultSetColumnMap: defaultSetColumnMap
			}
			<@popupId>["tableEditorPopupSnd"].reload(updateParm);

			<@popupId>.currentSelectDataFst = data;
			
			let titleComment	= sendParm.titleComment;
			if(isValid(titleComment)) {
				$.each(connectColumn, function() {
					titleComment = titleComment.render("[", "/]", data);
				});
				$("#<@popupId> #sndGridTitle").html(`<@sndGridTitle> ${titleComment}`);
			}
			
		 }
		,getFstGridInstance : function() {
			return <@popupId>["tableEditorPopupFst"].getGridInstance();
		 }
		,getSndGridInstance : function() {
			return <@popupId>["tableEditorPopupSnd"].getGridInstance();
		 }
	}
	// Popup Load가 완료된후 실행 된다.
	C_POP.onLoadPopup("<@popupId>", function(sendParm) {
		let gridParmFst 	= sendParm.gridParmFst;
		let gridParmSnd 	= sendParm.gridParmSnd;
		let connectColumn	= sendParm.connectColumn;
		
		let connectMapping	= sendParm.connectMapping;
		
		// A.COLUMN_NAME => COLUMN_NAME 으로 변경
		if(isEmpty(connectMapping)) {
			connectMapping = {};
			$.each(connectColumn, function(idx) {
				let fstColumnId = "" + this;
				const baseFstColumnId = getExtension(fstColumnId);
				connectMapping[baseFstColumnId] = fstColumnId;
				connectColumn[idx] 				= baseFstColumnId;
			});
			sendParm.connectColumn 	= connectColumn;
			sendParm.connectMapping = connectMapping;
		}
		
		<@popupId>.sendParm = sendParm;
		
		if(isEmpty(gridParmFst)) {
			C_POP.alert('첫번째 Grid 설정이 필요합니다.');
			setTimeout(<@popupId>.close, 300);
			return;
		}
		if(isEmpty(gridParmSnd)) {
			C_POP.alert('두번째 Grid 설정이 필요합니다.');
			setTimeout(<@popupId>.close, 300);
			return;
		}
		
		gridParmFst.rowConfig = {
			onClickRow : function(data) {
				<@popupId>.onClickRowFst(data);
			}
		}
		gridParmFst.rowCntId = "<@popupId>_rowCntFst";
		C_COMP.import("tableEditorPopupFst", "component_compGrid",{gridParm : gridParmFst} , function(tableList) {
			// 최초 Setting 
			let fstData = tableList[0];

			<@popupId>.currentSelectDataFst = fstData;
			let searchWhereMap = gridParmSnd.searchWhereMap;
			if(isEmpty(searchWhereMap)) searchWhereMap = {};
			$.each(connectColumn, function(idx) {
				let fstColumnId = "" + this;
				// 기본 연계 Column명은 동일함.
				let sndColumnId = fstColumnId;
				
				// 다를경우 connectMapping으로 컬럼명을 전달 받음
				if(isValid(connectMapping[fstColumnId])) sndColumnId = connectMapping[fstColumnId] 

				searchWhereMap[sndColumnId] = fstData[fstColumnId];
				
				let columnObj = gridParmSnd.columnMap[sndColumnId];
				
				if(isValid(columnObj)) {
					if(isEmpty(columnObj.headerText		)) columnObj.headerText 	= columnId;
					if(isEmpty(columnObj.initSetData	)) columnObj.initSetData 	= function() { return <@popupId>.currentSelectDataFst[fstColumnId] };
				}
			});
			gridParmSnd.searchWhereMap = searchWhereMap;
			gridParmSnd.rowCntId = "<@popupId>_rowCntSnd";
			
			if(gridParmFst.readOnly == "Y") {
				$("#<@popupId> #saveBtnFst").hide();
			}
			if(gridParmSnd.readOnly == "Y") {
				$("#<@popupId> #saveBtnSnd").hide();
			}
			
			C_COMP.import("tableEditorPopupSnd", "component_compGrid",{gridParm : gridParmSnd} , function() {

			});		

			<@popupId>.onClickRowFst(fstData);
		});	
		let leftSizeClass 	= "col5";
		let rightSizeClass 	= "col5";
		if(isValid(sendParm.gridSize)) {
			leftSizeClass 	= "col" + sendParm.gridSize[0];
			rightSizeClass 	= "col" + sendParm.gridSize[1];
		}
		$("#<@popupId> #leftGrid").addClass(leftSizeClass);
		$("#<@popupId> #rightGrid").addClass(rightSizeClass);
		
		// ID로 설정된 항목 숨기기
		if(isValid(sendParm.hideDomIdList)) {
			$.each(sendParm.hideDomIdList, function() {
				$(`#<@popupId> #${this}`).hide();				
			});
		}
		
	});
</script>
<!-- modal-popup start -->
<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="full-modal-dialog modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <!-- header start -->
        <div class="modal-header srch-pop-inwrap">
          <h5 class="modal-title col9 col8-md col7-sm"><@popupTitle></h5>
          <!-- button start -->
          <div class="txt-r col1 col2-md col3-sm">
            <button type="button" class="win-fullcls" style="display:none">
            </button>
            <button type="button" class="win-full" style="display:none">
            </button>
            <button type="button" class="close" aria-label="Close" onclick="<@popupId>.close()">
              <span class="pop-cls" aria-hidden="true"></span>
            </button>
          </div>
          <!-- button end -->
        </div>
        <!-- header end -->
  
        <!-- body start -->
        <div class="modal-body">
          <div class="body-inwrap display-row-nowrap-md"> <!-------------------- 테이블 좌, 우 배치 시 -- 이 부분에 클래스명 추가 ( display-row-nowrap-md ) // 테이블 하나의 경우 클래스명 추가 불필요 -------------------->

            <!-- table area start -->
            <div class="tb-card-allwrap col10-md col10-sm mt10" id="leftGrid">
                <div class="card-inwrap">
                    <div id="tb-scroll" class="card-cnt-wrap">
                        <div class="table-allwrap display-column"> <!-------------------- 이 부분에 클래스명 추가 ( display-column ) -------------------->
                            <div class="card-tit-wrap">
                                <div class="card-tit"><@fstGridTitle></div>
                            </div>
                            <div class="display-between display-sm-between deco-line pt10 pl10 pr10 pb5">
                                <div class="col4-md col10-sm display-h-end mb5">
                                  <span class="col2-sm w80px mb3" id="searchTitleFst">검색어</span>
                                  <input type="text" class="form-control form-control-sm mr5" id="searchValueFst" onEnter="<@popupId>.reloadFst()">
                                  <button class="srch-btn" type="button" onclick="<@popupId>.reloadFst()">검 색</button>       
                                </div>
                                <div class="display-w-end col4 col4-md col10-sm mb5">
                                  <span class="col2-sm w120px txt-r mr10">Total : <span class="txt-red" id="<@popupId>_rowCntFst"></span></span>              
                                  <button class="flat-btn col2-sm" type="button" onclick="<@popupId>.saveFst()" id="saveBtnFst">저장</button>
                                </div>
                            </div>
                            <div class="table-inwrap-scroll"> <!-------------------- 이 부분에 div + 클래스명 추가 ( table-inwrap-scroll ) -------------------->
								<!-- table start -->
								<compnent id="tableEditorPopupFst"></compnent>    
								<!-- table end -->        
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- table area end -->            

            <!-- table area start -->
            <div class="tb-card-allwrap col10-md col10-sm mt10" id="rightGrid">
                <div class="card-inwrap">
                    <div id="tb-scroll" class="card-cnt-wrap">
                        <div class="table-allwrap display-column"> <!-------------------- 이 부분에 클래스명 추가 ( display-column ) -------------------->
                            <div class="card-tit-wrap">
                                <div class="card-tit" id="sndGridTitle"><@sndGridTitle></div>
                            </div>
                            <div class="display-between display-sm-between deco-line pt10 pl10 pr10 pb5">
                                <div class="col4-md col10-sm display-h-end mb5">
                                  <span class="col2-sm w80px mb3" id="searchTitleSnd">검색어</span>
                                  <input type="text" class="form-control form-control-sm mr5" id="searchValueSnd" onEnter="<@popupId>.reloadSnd()">
                                  <button class="srch-btn" type="button" onclick="<@popupId>.reloadSnd()">검 색</button>       
                                </div>
                                <div class="display-w-end col4 col4-md col10-sm mb5">
                                  <span class="col2-sm w120px txt-r mr10">Total : <span class="txt-red" id="<@popupId>_rowCntSnd"></span></span>              
                                  <button class="flat-btn col2-sm" type="button" onclick="<@popupId>.saveSnd()" id="saveBtnSnd">저장</button>
                                </div>
                            </div>
                            <div class="table-inwrap-scroll"> <!-------------------- 이 부분에 div + 클래스명 추가 ( table-inwrap-scroll ) -------------------->
								<!-- table start -->
								<compnent id="tableEditorPopupSnd"></compnent>    
								<!-- table end -->        
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- table area end -->            

          </div>        
        </div>
        <!-- body end -->
  
        <!-- footer start -->
        <div class="modal-footer">
          <button type="button" class="btn outline-btn" onclick="C_COM.showHelp({helpType : 'POPUP', helpTitle : '<@popupTitle>', templateId : '<@helpTemplateId>'})">도움말</button>
          <button type="button" class="btn outline-btn mr20" onclick="<@popupId>.close()">Close</button>
        </div>
        <!-- footer end -->
      </div>
    </div>
  </div>                      
  <!-- modal-popup end -->
