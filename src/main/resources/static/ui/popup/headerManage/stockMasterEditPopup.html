<meta charset="utf-8">
<script type="text/javascript">
	var <@popupId> = {
		 sendParm			: {}
		,grid2TableList		: []
		,grid2TableMap		: {}
		,close : function(returnData) {
			if(isEmpty(returnData)) returnData = {};
			C_POP.close(returnData);
		 }
		,loadGrid1 : function(callback) {
			let sendParm = {
				gridParm : 	{
					 tableName		: "TBL_EXP_STOCK_MST"
					,columnMap 		: {
						 "STOCK_MST_ID"		: { headerText : "재고ID"	, hidden : "Y", ifNewAutoSet : "random"					}
						,"BRAND_ID"			: { headerText : "브랜드ID"	, hidden : "Y", default : G_VAL.session.BRAND_ID 	}
						,"PRODUCT_CD"		: { headerText : "상품코드"		}
						,"PRODUCT_TYPE"		: { headerText : "상품타입"		}
						,"PRODUCT_NM"		: { headerText : "상품명"		}
						,"UNIT"				: { headerText : "단위"			}
						,"SAVE_PERIOD"		: { headerText : "적정기간"	,notNull : "Y"	}
						,"USE_YN"			: { headerText : "사용여부"	,notNull : "Y", columnType : "selectbox", useCodeId : "YES_OR_NO" 	}
					 }
					,columnConfig 	: {
						 onChangeCell : {
							"PRODUCT_CD"	: {
								 func 		: function(gridObj, rowIdx, colIdx, cellObj, rowData) {
									 
									 const g2Data = <@popupId>.grid2TableMap[rowData.PRODUCT_CD];
									 
									 gridObj.setCellToColumn(cellObj, "M"					, "PRODUCT_TYPE"	);
									 gridObj.setCellToColumn(cellObj, g2Data.MATERIALS_NM	, "PRODUCT_NM"		);
									 gridObj.setCellToColumn(cellObj, g2Data.UNIT			, "UNIT"			);
									 gridObj.setCellToColumn(cellObj, "Y"					, "USE_YN"			);
									 
									 
									
								 }						
							}
						 }
					 }
					,rowConfig : {
						onDeleteRow : function(rowDom, rowData) {
							//dalert(rowData);
							<@popupId>.setGrid2Checkbox();
						}
					 }
					,primaryKeyList		: ["STOCK_MST_ID"]
					,uniqueKeyList		: ["PRODUCT_CD"]
					,searchColumnList	: ["PRODUCT_CD", "PRODUCT_TYPE", "PRODUCT_NM", "USE_YN"]		
					,orderColumnList 	: ["PRODUCT_CD"]
					,searchWhereMap		: { "BRAND_ID" : G_VAL.session.BRAND_ID }
					,onLoad				: function(tableList) {
						<@popupId>.setGrid2Checkbox();
					 }
				 }
				,gridTitle : "재고 Master 목록"
			}
			C_COMP.import("gridComp1", "component_compGridWithSearch",sendParm , function(tableList) {
				if(typeof callback == "function") callback();
			});		
			
		 }
		,loadGrid2 : function() {
			let sendParm2 = {
				gridParm : {
					 requestQuery	: {
						  queryId		: "headerManage.getMaterialsMasterList"
						 ,requestParm	: {}
					 }
					,tableName		: "TBL_EXP_FOOD_MATERIALS_MASTER"
					,columnMap 		: {
						 "MATERIALS_MASTER_ID" 			: { headerText : "MATERIALS_ID"	, hidden : "Y", ifNewAutoSet : "random"					}
						,"MATERIALS_CD"        			: { headerText : "식자재CD"  	, width	 : "120px"										}
						,"MATERIALS_NM"        			: { headerText : "식자재명"  															}
						,"PRODUCT_CLASS"       			: { headerText : "자재구분"		, columnType : "selectbox", useCodeId : "PRODUCT_CLASS" }
						,"UNIT"                			: { headerText : "단위(g/ea)"															}
						,"CONVERSION_UNIT_PRICE"		: { headerText : "단가"    		,dataType : "number", fix : "2"							}
					 }
					,columnConfig 	: {
					 }
					,rowConfig		: {
						onChangeCheckBoxState : function(state, rowData) {
							let grid2Object = <@popupId>["gridComp1"].getGridInstance();

							if(state) {
								// Grid2에 Row 삽입
								rowData.PRODUCT_CD 		= rowData.MATERIALS_CD;
								grid2Object.addNewRow(rowData);
							} else {
								// Grid2에 해당Row 삭제
								let parm = {
									searchList : [
										{ column : "PRODUCT_CD", searchVal : rowData.MATERIALS_CD }
									]
								}
								let tdCellList = grid2Object.searchCellList(parm);
								
								if(isValid(tdCellList)) {
									grid2Object.deleteRow(tdCellList);	
								}
							}
							let cnt = <@popupId>["gridComp1"].refreshTotalCnt();
						 }
						,onChangeAllCheckBoxState : function(checked) {
						 }
					 }
					,primaryKeyList		: ["MATERIALS_MASTER_ID"]
					,uniqueKeyList		: ["MATERIALS_CD"]
					,searchColumnList	: ["MATERIALS_CD", "MATERIALS_NM"]	// Table 지정인경우 적용
					,orderColumnList 	: ["B.SORT_ORDER", "MATERIALS_CD"]
					,searchWhereMap		: { BRAND_ID : G_VAL.session.BRAND_ID } 
					,checkbox			: "show"
					,allCheckHide		: "Y"
					,readOnly			: "Y"
					,onLoad				: function(tableList) {
						<@popupId>.setGrid2Checkbox();	
					 }
				 }
				,gridTitle : "식자재 Master 목록"
			}
			
			C_COMP.import("gridComp2", "component_compGridWithSearch",sendParm2 , function(tableList) {
				<@popupId>.grid2TableList	= tableList;
				<@popupId>.grid2TableMap	= arrayToMap(tableList, "MATERIALS_CD");
			});		
			
		 }
		,setGrid2Checkbox : function() {
			
			if(isEmpty(<@popupId>["gridComp2"])) return;

			// Grid2 Data
			let grid1TableList = <@popupId>["gridComp1"].getGridData("view");
			let grid2Instance  = <@popupId>["gridComp2"].getGridInstance();
			
			if(isEmpty(grid1TableList) || isEmpty(grid2Instance)) return;
			
			grid2Instance.setAllCheckBox(false);
			
			$.each(grid1TableList, function() {
				let parm = {
					searchList : [
						{
							 column 	: "MATERIALS_CD"
							,searchVal	: this.PRODUCT_CD 
						}
					]
				}
				let tdCellList = grid2Instance.searchCellList(parm);
				$.each(tdCellList, function() {
					grid2Instance.setCheckBox(this, true);	
				});
			});
		 }
		
	}
	// Popup Load가 완료된후 실행 된다.
	C_POP.onLoadPopup("<@popupId>", function(parm) {
		
		////////////////////// 첫번째 그리드 ////////////////////////////////////
		
		<@popupId>.loadGrid1(function() {

			////////////////////// 두번째 그리드 ////////////////////////////////////
			<@popupId>.loadGrid2();
		});
		

	});
</script>
<!-- modal-popup start -->
<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="full-modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <!-- header start -->
        <div class="modal-header srch-pop-inwrap">
          <h5 class="modal-title col9 col8-md col7-sm">재고 마스터 편집</h5>
          <!-- button start -->
          <div class="txt-r col1 col2-md col3-sm">
            <button type="button" class="win-fullcls" style="display:none">
            </button>
            <button type="button" class="win-full" style="display:none">
            </button>
            <button type="button" class="close" aria-label="Close" onclick="<@popupId>.close()">
              <span class="pop-cls" aria-hidden="true"></span>
            </button>
          </div>
          <!-- button end -->
        </div>
        <!-- header end -->
  
        <!-- body start -->
        <div class="modal-body">
          <div class="body-inwrap display-row-nowrap-md"> <!-------------------- 테이블 좌, 우 배치 시 -- 이 부분에 클래스명 추가 ( display-row-nowrap-md ) // 테이블 하나의 경우 클래스명 추가 불필요 -------------------->

            <!-- table area start -->
            <div class="tb-card-allwrap col5 col10-md col10-sm mt10">
                <div class="card-inwrap">
                    <div id="tb-scroll" class="card-cnt-wrap">
						<!-- table start -->
						<compnent id="gridComp1"></compnent>    
						<!-- table end -->        
                    </div>
                </div>
            </div>
            <!-- table area end -->            

            <!-- table area start -->
            <div class="tb-card-allwrap col5 col10-md col10-sm mt10">
                <div class="card-inwrap">
                    <div id="tb-scroll" class="card-cnt-wrap">
						<!-- table start -->
						<compnent id="gridComp2"></compnent>    
						<!-- table end -->        
                    </div>
                </div>
            </div>
            <!-- table area end -->            

          </div>        
        </div>
        <!-- body end -->
  
        <!-- footer start -->
        <div class="modal-footer">
          <button type="button" class="btn outline-btn mr20" onclick="<@popupId>.close()">Close</button>
        </div>
        <!-- footer end -->
      </div>
    </div>
</div>                      
<!-- modal-popup end -->
