<meta charset="utf-8">
<script type="text/javascript">
	var <@popupId> = {
		 brandId	: G_VAL.session.BRAND_ID
		,storeId 	: "<@storeId>"
		,close : function(returnData) {
			if(isEmpty(returnData)) returnData = {};
			C_POP.close(returnData);
		 }
		,loadComponent : function(parm) {
			
			let gridParm = {
				 requestQuery	: {
					  queryId		: "headerManage.getStoreMenuList"
					 ,requestParm	: {
						 STORE_ID : parm.storeId
					  }
				 }
				,tableName		: "TBL_EXP_STORE_MENU_MST"
				,columnMap 		: {
					 "MENU_ID"          : { headerText : "MENU_ID"		, hidden 		: "Y", ifNewAutoSet : "random"			 	} 
					,"STORE_ID"         : { headerText : "가맹점ID"		, hidden 		: "Y", default : <@popupId>.storeId 	} 
					,"MENU_CD" 			: { headerText : "메뉴CD"																} 
					,"MENU_NM"          : { headerText : "메뉴명"       														} 
					,"SELLING_PRICE"    : { headerText : "가격"	,dataType : "number"											} 
					,"BRAND_MENU_CD" 	: { headerText : "본사메뉴CD"	, columnType	: "popup"								} 
					,"BRAND_MENU_NM"    : { headerText : "본사메뉴명"	, columnType	: "readOnly", noSave	: "Y"			}
					,"GROUP_1"      	: { headerText : "대분류CD"		, hidden 		: "Y",									}
					,"GROUP_1_NM"      	: { headerText : "대분류명"		, columnType	: "readOnly", noSave	: "Y"			}
					,"GROUP_2"      	: { headerText : "중분류CD"		, hidden 		: "Y",									}
					,"GROUP_2_NM"      	: { headerText : "중분류명"		, columnType	: "readOnly", noSave	: "Y"			}
					,"BRAND_SELLING_PRICE": { headerText : "판매가"		, columnType	: "readOnly", noSave	: "Y", 	dataType : "number"} 
				 }
				,headerTextGroup	: {
					"본사메뉴" : [
						 "BRAND_MENU_CD"
						,"BRAND_MENU_NM"
						,"GROUP_1"   
						,"GROUP_1_NM"   
						,"GROUP_2"   
						,"GROUP_2_NM"   
						,"BRAND_SELLING_PRICE"
					]
				 }
				,columnConfig : {
					 popupConfig		: {
						"BRAND_MENU_CD" : {
							 popupId 	: "popup_storeManage_brandMenuSelectPopup"
							,parmFn 	: function() {
								return { storeId : <@popupId>.storeId }
							 }
							,resultFn	: function(gridObj, targetDom, resultData) {
								if(isEmpty(resultData.BRAND_MENU_CD)) return;
								gridObj.setCell(targetDom, resultData.BRAND_MENU_CD);
							 }
						}
					 }
					,onChangeCell : {
						"BRAND_MENU_CD"	: {
							 func 		: function(gridObj, rowIdx, colIdx, cellObj) {
								let dataObj = C_GRID.getDataFromCell(cellObj);
								let brandMenuCd = dataObj.value;
								var parm = {
									 queryId 		: "headerManage.getBrandMenuOne"
									,requestParm	: {
										 BRAND_ID 		: G_VAL.session.BRAND_ID
										,BRAND_MENU_CD	: brandMenuCd
									}
								}
						        C_COM.requestQuery(parm, function(resultData) {
						        	if(typeof resultData == "object" && resultData.data.length > 0) {
						        		let item = resultData.data[0];
						        		
						        		gridObj.setCellToColumn(cellObj, item.MENU_NM		,"BRAND_MENU_NM"	);
						        		gridObj.setCellToColumn(cellObj, item.GROUP_1		,"GROUP_1"			);
						        		gridObj.setCellToColumn(cellObj, item.GROUP_1_NM	,"GROUP_1_NM"		);
						        		gridObj.setCellToColumn(cellObj, item.GROUP_2		,"GROUP_2"			);
						        		gridObj.setCellToColumn(cellObj, item.GROUP_2_NM	,"GROUP_2_NM"		);
						        		gridObj.setCellToColumn(cellObj, item.SELLING_PRICE	,"SELLING_PRICE"	);
						        		gridObj.setCellToColumn(cellObj, item.SELLING_PRICE	,"BRAND_SELLING_PRICE"	);
						        	}
						        });
							 }						
						}
					 }
				
				 }
				,primaryKeyList		: ["A.STORE_ID"	, "MENU_CD"]
				,searchColumnList	: ["A.MENU_CD"	, "A.MENU_NM", "B.BRAND_MENU_CD", "B.MENU_NM"]
				,searchWhereMap		: {"C.BRAND_ID" : G_VAL.session.BRAND_ID, "A.STORE_ID" : function() { return <@popupId>.storeId }}
				,orderColumnList 	: ["A.MENU_CD ASC"] // ORDER BY에 사용
				,rowCntId			: "<@popupId>_rowCnt"
				//,readOnly			: "Y"
			}
			C_COMP.import("storeMenuEditGrid", "component_compGrid",{gridParm : gridParm} , function() {});		
		 }
		,setStoreList : function(brandId, callback) {
			if(isEmpty(brandId)) {
				C_POP.alert('Brand ID가 필요합니다.');
				return;
			}
			var parm = {
				 queryId 		: "common.getStoreList"
				,requestParm	: {BRAND_ID : brandId}
			}
	        C_COM.requestQuery(parm, function(resultData) {
	        	let selectList = C_COM.makeCodeList(resultData.data, "STORE_ID", "STORE_NM");
	    		var singleboxList = { 
	   				 data 			: selectList
	   			 	,targetId 		: "<@popupId>_storeList"
	   			}
	   			C_UICOM.makeSelectBox(singleboxList, "single");
	    		
	    		C_UICOM.setSingleBox("<@popupId>_storeList", <@popupId>.storeId );
	    		
	    		if(selectList.length > 0 ) {
	    			if(typeof callback == "function") callback(selectList[0]); 
	    		}
	        });
		 }
		,save : function() {
			C_POP.confirm('저장하시겠습니까?', function() {
				<@popupId>["storeMenuEditGrid"].save(function(returnData) {
					if(returnData.state == "S") {
						C_POP.alert('저장하였습니다.');
						<@popupId>.close({reload : 'Y'});
					}
				});
			})
		 }
		,reload : function(storeId) {
			if(isEmpty(storeId)) storeId = <@popupId>.storeId;			

			if(isEmpty(storeId)) { 
				C_POP.alert('가맹점을 선택해 주세요.');
				return;
			}
		
			let searchValue = $("#<@popupId> #searchValue").val();
			let requestParm	= {
				 STORE_ID 		: storeId
				,searchValue	: searchValue 
			}
			<@popupId>["storeMenuEditGrid"].reload(requestParm);
		 }
		,changeStore : function(selectDom) {
			let storeId = $(selectDom).find("option:selected").attr("value");
			<@popupId>.storeId = storeId;
			<@popupId>.reload(storeId);
		 }
		
	}
	// Popup Load가 완료된후 실행 된다.
	C_POP.onLoadPopup("<@popupId>", function(parm) {
		
		let brandId = parm.brandId;
		if(isEmpty(brandId)) brandId = G_VAL.session.BRAND_ID;
		
		<@popupId>.setStoreList(brandId, function(obj) {
			if(isEmpty(obj)) {
				C_POP.alert('가맹점 등록이 필요합니다.');
				return;
			}
			if(isEmpty(parm.storeId)) parm.storeId = obj[0];
			
			<@popupId>.storeId = parm.storeId;
			
			<@popupId>.loadComponent(parm);
		});
	});
</script>
  <!-- modal-popup start -->
  <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <!-- header start -->
        <div class="modal-header srch-pop-inwrap">
          <h5 class="modal-title col9 col8-md col7-sm" id="exampleModalLongTitle">가맹점 메뉴 편집</h5>
          <!-- button start -->
          <div class="txt-r col1 col2-md col3-sm">
            <button type="button" class="win-fullcls" onclick="C_POP.normalSize('<@popupId>')">
            </button>
            <!-- <button type="button" class="win-full" onclick="C_POP.fullSize('<@popupId>')"> -->
            <button type="button" class="win-full" onclick="C_POP.maxSize('<@popupId>')">
            
            </button>
            <button type="button" class="close" aria-label="Close" onclick="<@popupId>.close()">
              <span class="pop-cls" aria-hidden="true"></span>
            </button>
          </div>
          <!-- button end -->
        </div>
        <!-- header end -->
        <div class="modal-body">                            
			<!-- search filter box start -->
			<div class="display-between display-sm-between">
				<div class="col4-md col10-sm display-h-end">
					<span class="col2-sm w150px mb3">가맹점</span>
		            <select class="form-control form-control-sm w300px col6-sm mr20" id="<@popupId>_storeList" onChange="<@popupId>.changeStore(this)">
		            </select>                
					<span class="col2-sm w150px mb3">검색어</span>
					<input type="text" class="form-control form-control-sm mr5" id="searchValue" onEnter="<@popupId>.reload()">
					<button class="srch-btn" type="button" onclick="<@popupId>.reload()">검 색</button>
				</div>
				<div class="display-w-end col4 col4-md col10-sm">
					<span class="col2-sm w120px txt-r mr10">Total : <span class="txt-red" id="<@popupId>_rowCnt"></span></span>
					&nbsp;&nbsp;<button class="flat-btn col2-sm" type="button" onclick="<@popupId>.save()">저장</button>
				</div>
			</div>
			<!-- search filter box end --> 
		
		    <!-- table area start -->
			<div class="tb-card-allwrap col10 mt10">
				<div class="card-inwrap">
					<div class="card-cnt-wrap">
						<div class="table-allwrap">
							<compnent id="storeMenuEditGrid"></compnent>
						</div>
					</div>
				</div>    
			</div>    
		    <!-- table area end -->
        </div>
        <!-- footer start -->
        <div class="modal-footer">
          <button type="button" class="btn outline-btn mr20" onclick="<@popupId>.close()">Close</button>
        </div>
        <!-- footer end -->
      </div>
    </div>
  </div>                      
  <!-- modal-popup end -->
