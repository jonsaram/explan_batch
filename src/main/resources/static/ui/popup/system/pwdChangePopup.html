<meta charset="utf-8">
<script type="text/javascript">
	var <@popupId> = {
		 close : function(returnData) {
			if(isEmpty(returnData)) returnData = {};
			C_POP.close(returnData);
		 }
		,pageInit : function() {
			 const session = G_VAL.session;
			 $("#<@popupId>_pwdChgTitle").text("비밀번호 변경")
			 $("#<@popupId>_cardTitle").text("로그인 비밀번호 변경")
			 $("#<@popupId>_buyerId").text(session.USER_ID);
			 $("#<@popupId>_buyerNm").text(session.USER_NM);
			 $("#<@popupId>_curPwd").val("");
			 $("#<@popupId>_newPwd").val("");
			 $("#<@popupId>_confirmPwd").val("");
		}
		,validation : function(curPwd,newPwd,cfmPwd) {
			
			 if( isEmpty(curPwd) ) {C_POP.alert("현재 로그인 PWD를 입력하여 주십시오."	); return false;}
			 if( isEmpty(newPwd) ) {C_POP.alert("변경 PWD를 입력하여 주십시오."	); return false;}
			 if( isEmpty(cfmPwd) ) {C_POP.alert("확인 PWD를 입력하여 주십시오."	); return false;}
			 if( newPwd != cfmPwd) {C_POP.alert("변경하고자하는 비밀번호와\n확인용 비밀번호를 동일하게 입력하여 주십시오."); return false;}
			 if( curPwd == cfmPwd) {C_POP.alert("현재 비밀번호와 동일한 번호로 변경할 수 없습니다.\n새로운 비밀번호를 입력하여 주십시오."); return false;}
  			 
			 const passwordRegex = /^(?=.*\d)(?=.*[a-zA-Z])(?=.*[\W_]).{8,}$/;
			 console.log(passwordRegex.test(newPwd));
			 console.log("newPwd:", newPwd.trim());
			 console.log("passwordRegex:", passwordRegex);
			 console.log("test result:", passwordRegex.test(newPwd.trim()));

			 if (!passwordRegex.test(newPwd)) {
				 //C_POP.alert("비밀번호는 숫자, 문자, 특수문자를 포함하여 8자 이상이어야 합니다.");
				 //return false;
			 }
 			 
			 return true;
		}
		,save : function() {
			
			 const curPwd = $("#<@popupId>_curPwd").val();
			 const newPwd = $("#<@popupId>_newPwd").val();
			 const cfmPwd = $("#<@popupId>_confirmPwd").val();
			 
			if( <@popupId>.validation(curPwd,newPwd,cfmPwd) ){
			
				C_POP.confirm("새로운 비밀번호로 수정 하시겠습니까?", function() {
					const buyerInfo = G_VAL.session;
		 			var parm = {
	 						queryId 	: "system.updatePwd"
	 					   ,requestParm	: {
										CUR_PWD :curPwd,
										USER_ID:G_VAL.session.USER_ID,
										NEW_PWD :newPwd,
										USER_TYPE:G_VAL.session.USER_TYPE
										
	 						}
		 			}
		 			
		 			C_COM.requestQuery(parm, function(resultData) {
		 				
		                 if (resultData.state === 'S') {
		                	 
				            if( resultData.data[0].cnt == 1 ){
		                 		alert('비밀번호가 변경되었습니다.\n변경된 비밀번호로 다시 로그인하여 주십시오.');
		                 		C_COM.saveSessionData("session", G_VAL.session);
			                 	location.replace(_WEB_ROOT_URL + "/loginMain.html");
							}else{
								alert('현재 비밀번호가 올바르지 않습니다.\n현재 비밀번호를 다시 입력하여 주십시오.');
							}   	 
		     			} else {
		                 	alert('변경 등록을 실패 하였습니다.');
		     			}
		 			});
		 			
				});
			}
			
			return true;
		 }
	}
	// Popup Load가 완료된후 실행 된다.
	C_POP.onLoadPopup("<@popupId>", function(data) {
	  
		<@popupId>.pageInit();

	});
</script>
<style>
input[type="password"] {
    font-family: sans-serif; 
}
</style>
    <!-- modal-popup start full-modal-dialog-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 700px;">
        <div class="modal-content">
            <!-- header start -->
            <div class="modal-header srch-pop-inwrap">
                <h5 class="modal-title col7 col8-md col7-sm" id="<@popupId>_pwdChgTitle">비밀번호 변경</h5>
                <!-- button start -->
                <div class="txt-r col3 col2-md col3-sm">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="<@popupId>.close()">
                    <span class="pop-cls" aria-hidden="true"></span>
                    </button>
                </div>
                <!-- button end -->
            </div>
            <!-- header end -->
    
            <!-- body start -->
            <div class="modal-body">
            <div class="body-inwrap">
    
                <div class="display-between">
                    <div class="card-tit" id="<@popupId>_cardTitle">비밀번호 변경</div>
                </div>
                <!-- table area start -->
                <div class="tb-card-allwrap03 col10">
                    <div class="card-inwrap">
                        <div id="tb-scroll" class="card-cnt-wrap">
                            <!-- table start -->
                            <table class="tb-wr-wrap tb-read-wrap company-wh col10">
                                <colgroup>
                                    <col>
                                    <col>
                                </colgroup>
                                
              					<form  autocomplete="off">
                                <tbody>
                                    <tr>
                                        <th class="col2 col2-md col2-sm col1-xs" >로그인 ID</th>
                                        <td class="col8 col8-md col8-sm col9-xs" id="<@popupId>_buyerId">
                                        </td>                         
                                    </tr>
                                    <tr>
                                        <th class="col2 col2-md col2-sm col1-xs" >로그인 명</th>
                                        <td class="col2 col2-md col2-sm col9-xs" id="<@popupId>_buyerNm">
                                        </td>
                                    </tr>
                                    <tr>
    
                                        <th class="col2 col2-md col2-sm col1-xs">현재 로그인 PWD</th>
                                        <td class="col2 col2-md col2-sm col9-xs">
                                            <input type="password" class="form-control form-control-sm col10" id="<@popupId>_curPwd" autocomplete="new-password" aria-autocomplete="none">
										</td>                                            
                                    </tr>
                                    <tr>
                                        <th class="col2 col2-md col2-sm col1-xs">변경 PWD</th>
                                        <td class="col2 col2-md col2-sm col9-xs">
                                            <input type="password" class="form-control form-control-sm col10" id="<@popupId>_newPwd" autocomplete="off">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th class="col2 col2-md col2-sm col1-xs">확인 PWD</th>
                                        <td class="col2 col2-md col2-sm col9-xs">
                                            <input type="password" class="form-control form-control-sm col10" id="<@popupId>_confirmPwd" autocomplete="off">
                                        </td>
                                    </tr>                                                                                                                                                                                                                                                                                                                                                                                  
                                </tbody>
               					</form>
                                </table>
                            <!-- table end -->
                        </div>
                    </div>
                </div>
                <!-- table area end -->
            </div>        
            </div>
            <!-- body end -->
    
            <!-- footer start -->
            <div class="modal-footer">
                <button type="button" class="btn flat-btn" onclick="<@popupId>.save()">저 장</button>
                <button type="button" class="btn outline-btn mr20" data-dismiss="modal" onclick="<@popupId>.close()">취 소</button>
            </div>
            <!-- footer end -->
        </div>
        </div>
    </div>                      
    <!-- modal-popup end -->
