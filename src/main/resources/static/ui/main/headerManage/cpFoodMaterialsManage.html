<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		 companyId 	: ""
		,gridParm	: {}
		,loadComponent : function(parm) {
			let searchValue = $("#<@pageId> #searchWord").val();
			let gridParm = {
				 requestQuery	: {
					  queryId		: "headerManage.getMaterialsCompanyProductList"
					 ,requestParm	: {}
				 }
				,columnMap 		: {
					 "PRODUCT_ID"         	: { headerText : "상품ID"	,hidden		:"Y"          				} 
					,"COMPANY_ID"         	: { headerText : "업체ID"	,hidden		:"Y"          				} 
					,"PRODUCT_CD"       	: { headerText : "상품코드"        									} 
					,"PRODUCT_NM"         	: { headerText : "상품명"   ,width		: "200px", align : "left"	} 
					,"CONVERSION_QUANTITY"	: { headerText : "용량"    	,dataType : "number" 					}
					,"UNIT_PRICE"          	: { headerText : "단가(원)" ,dataType : "number" 					}
					,"DEL_YN"             	: { headerText : "삭제여부" 										}
					,"MATERIALS_CD"       	: { headerText : "상품CD"											} 
					,"MST_MATERIALS_NM"     : { headerText : "상품명"   										}
					,"MST_PRODUCT_CLASS"    : { headerText : "분류"    ,columnType : "selectbox", useBrandCodeId : "STORE_MENU_GROUP1" }
					//,"MST_UNIT"             : { headerText : "단위"    										}
					//,"MST_CONVERSION"       : { headerText : "환산"    										}
					//,"MST_UNIT_PRICE"       : { headerText : "단가"    										}
				 }
				,headerTextGroup	: {
					"Master 식자재" : [
						 "MATERIALS_CD"     
						,"MST_MATERIALS_NM"  
						,"MST_PRODUCT_CLASS" 
					]
				 }
				,columnConfig : {
				 }
				,primaryKeyList		: ["PRODUCT_ID"]
				,searchColumnList	: ["A.PRODUCT_CD", "A.PRODUCT_NM", "A.MATERIALS_CD", "B.MATERIALS_NM"]
				,orderColumnList 	: ["B.SORT_ORDER, A.PRODUCT_CD"]
				,searchWhereMap		: {"A.COMPANY_ID" : parm.companyId }
				,rowCntId			: "<@pageId>_rowCnt"
				,readOnly			: "Y"
			}
			C_COMP.import("cpFoodMaterialsGrid", "component_compGrid",{gridParm : gridParm} , function() {});	
			
			<@pageId>.gridParm = gridParm;
			
		 }
		,openEdit : function() {
			C_POP.open("popup_headerManage_cpFoodMaterialsEditPopup", {companyId : <@pageId>.companyId}, function(retData){
				if(retData.reload == "Y") {
					<@pageId>.reload();
				}
			});
		 }
		,reload : function(companyId) {
			if(isEmpty(companyId)) companyId = <@pageId>.companyId;			

			if(isEmpty(companyId)) { 
				C_POP.alert('물류회사를 선택해 주세요.');
				return;
			}
		
			let searchValue = $("#<@pageId> #searchValue").val();
			
			let updateParm = {
				 searchWhereMap : {
					"A.COMPANY_ID" : companyId 
				 }
				,searchValue : searchValue
			}
			<@pageId>["cpFoodMaterialsGrid"].reload(updateParm);
		 }
		,setMaterialsCompanyList : function(brandId, callback) {
			if(isEmpty(brandId)) {
				C_POP.alert('Brand ID가 필요합니다.');
				return;
			}
			var parm = {
				 queryId 		: "common.getMaterialsCompanyList"
				,requestParm	: {BRAND_ID : brandId}
			}
	        C_COM.requestQuery(parm, function(resultData) {
	        	let selectList = C_COM.makeCodeList(resultData.data, "COMPANY_ID", "COMPANY_NM");
	    		var singleboxList = { 
	   				 data 			: selectList
	   			 	,targetId 		: "<@pageId>_materialsCompanyList"
	   			}
	   			C_UICOM.makeSelectBox(singleboxList, "single");
	    		
	    		if(selectList.length > 0 ) {
	    			if(typeof callback == "function") callback(selectList[0]); 
	    		}
	        });
		 }
		,changeCompany : function(selectDom) {
			let companyId = $(selectDom).find("option:selected").attr("value");
			<@pageId>.companyId = companyId;
			<@pageId>.reload(companyId);
		 }
	}
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function(parm) {
		
		let brandId = parm.brandId;
		if(isEmpty(brandId)) brandId = G_VAL.session.BRAND_ID;
		
		<@pageId>.setMaterialsCompanyList(brandId, function(obj) {
			if(isEmpty(obj)) {
				C_POP.alert('물류회사 등록이 필요합니다.');
				return;
			}
			parm.companyId = obj[0];

			<@pageId>.companyId = parm.companyId;
			
			<@pageId>.loadComponent(parm);
		});

		C_COMP.import("<@pageId>_breadcrumb", "component_compBreadcrumb",{} , function() {});
		
		// 상단 Title 영역
		C_COMP.import("<@pageId>_titleArea", "component_compTitleArea",{} , function() {});
		
	});
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
</script>
<page-component>

    <!-- breadcrumb start -->
	<compnent id="<@pageId>_breadcrumb"></compnent>    
    <!-- breadcrumb end -->

    <!-- sub title + button start -->
	<compnent id="<@pageId>_titleArea"></compnent>    
    <!-- sub title + button end -->
     
	<!-- search filter box start -->
	<div class="srch-card mt10">
	    <div class="srch-card-inwrap">
	        <div class="col9 col10-sm srch-card-form">
	            <div class="col5 col5-md col10-sm display-h-end mb5">
	                <label class="src-title01">물류회사명</label>
		            <select class="form-control form-control-sm col6-sm mr20" id="<@pageId>_materialsCompanyList" onChange="<@pageId>.changeCompany(this)">
		            </select>    
	            </div>
	            <div class="col5 col5-md col10-sm display-h-end mb5">
	                <label class="src-title01">검색어</label>
	                <input type="text" class="form-control form-control-sm col10" id="searchValue" onEnter="<@pageId>.reload()">
	            </div> 
	        </div>
	        <div class="col1 col10-sm display-h-end pl-lg-15 mb5">
	            <button class="srch-btn col10 mr10" type="button" onclick="<@pageId>.reload()">검 색</button>
	        </div>
	    </div>
	</div>
    <div class="display-between display-sm-between mt10">
        <div class="col4-md col10-sm display-h-end mb5">
        </div>
        <div class="display-w-end col4 col4-md col10-sm mb5">
          <span class="col2-sm w150px txt-r mr10">Total : <span class="txt-red" id="<@pageId>_rowCnt"></span></span>
          <button class="flat-btn col2-sm" type="button" id="<@pageId>_editBtn" onclick="<@pageId>.openEdit()">편 집</button>
        </div>
    </div>
	<!-- search filter box end -->











    <!-- table area start -->
	<div class="tb-card-allwrap mt10">
		<div class="card-inwrap">
			<div class="card-cnt-wrap">
				<div class="table-allwrap">
					<compnent id="cpFoodMaterialsGrid"></compnent>
				</div>
			</div>
		</div>    
	</div>    
    <!-- table area end -->

</page-component>