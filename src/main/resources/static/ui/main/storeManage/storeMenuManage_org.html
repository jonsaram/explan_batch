<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		 storeId : ""
		,loadComponent : function(parm) {
			let searchValue = $("#<@pageId> #searchWord").val();
			let gridParm = {
				 requestQuery	: {
					  queryId		: "headerManage.getStoreMenuList"
					 ,requestParm	: {
						 STORE_ID : parm.storeId
					  }
				 }
				,tableName		: "TBL_EXP_STORE_MENU_MST"
				,columnMap 		: {
					 "STORE_ID"         : { headerText : "가맹점ID"	, hidden : "Y"	} 
					,"MENU_CD" 			: { headerText : "메뉴CD"					} 
					,"MENU_NM"          : { headerText : "메뉴명"       			} 
					,"BRAND_MENU_CD"  	: { headerText : "본사메뉴CD" 				} 
					,"BRAND_MENU_NM"    : { headerText : "본사메뉴명"				}
					,"GROUP_1_NM"      	: { headerText : "대분류CD"					}
					,"GROUP_2_NM"      	: { headerText : "중분류CD"					}
					,"SELLING_PRICE"    : { headerText : "판매가"					} 
				 }
				,headerTextGroup	: {
					"본사메뉴" : [
						 "BRAND_MENU_CD"
						,"BRAND_MENU_NM"
						,"GROUP_1_NM"   
						,"GROUP_2_NM"   
						,"SELLING_PRICE"
					]
				 }
				,columnConfig : {
				 }
				,primaryKeyList		: ["STORE_ID"]
				,searchColumnList	: ["MENU_CD", "MENU_NM", "BRAND_MENU_CD", "BRAND_MENU_NM"]
				,rowCntId			: "<@pageId>_rowCnt"
				,readOnly			: "Y"
			}
			C_COMP.import("storeMenuManageGrid", "component_compGrid",{gridParm : gridParm} , function() {});		
			
		 }
		,openEdit : function() {
			C_POP.open("popup_headerManage_storeMenuEditPopup", {storeId : G_VAL.current.storeId, size : "MAX"}, function(retData){
				if(retData.reload == "Y") {
					<@pageId>.reload();
				}
			});
		 }
		,reload : function(storeId) {

			if(isEmpty(storeId)) storeId = G_VAL.current.storeId;			

			if(isEmpty(storeId)) { 
				C_POP.alert('가맹점을 선택해 주세요.');
				return;
			}
		
			let searchValue = $("#<@pageId> #searchValue").val();
			
			requestQuery = {
				 queryId		: "headerManage.getStoreMenuList"
				,requestParm	: {
					 STORE_ID 		: storeId
					,searchValue	: searchValue 
				 }
			}
			<@pageId>["storeMenuManageGrid"].reload({ requestQuery : requestQuery });
		 }
		,setStoreList : function(brandId, callback) {
			if(isEmpty(brandId)) {
				C_POP.alert('Brand ID가 필요합니다.');
				return;
			}
			var parm = {
				 queryId 		: "common.getStoreList"
				,requestParm	: {BRAND_ID : brandId}
			}
	        C_COM.requestQuery(parm, function(resultData) {
	        	let selectList = C_COM.makeCodeList(resultData.data, "STORE_ID", "STORE_NM");
	    		var singleboxList = { 
	   				 data 			: selectList
	   			 	,targetId 		: "<@pageId>_storeList"
	   			}
	   			C_UICOM.makeSelectBox(singleboxList, "single");
	    		
	    		if(selectList.length > 0 ) {
	    			if(typeof callback == "function") callback(selectList[0]); 
	    		}
	        });
		 }
		,changeStore : function(selectDom) {
			let storeId = $(selectDom).find("option:selected").attr("value");
			G_VAL.current.storeId = storeId;
			<@pageId>.reload(storeId);
		 }
	}
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function(parm) {
		
		let brandId = parm.brandId;
		if(isEmpty(brandId)) brandId = G_VAL.session.BRAND_ID;
		
		<@pageId>.setStoreList(brandId, function(obj) {
			if(isEmpty(obj)) {
				C_POP.alert('가맹점 등록이 필요합니다.');
				return;
			}
			parm.storeId = obj[0];
			G_VAL.current.storeId = parm.storeId;
			
			<@pageId>.loadComponent(parm);
		});

		C_COMP.import("<@pageId>_breadcrumb", "component_compBreadcrumb",{} , function() {});
	});
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
</script>
<page-component>

    <!-- breadcrumb start -->
	<compnent id="<@pageId>_breadcrumb"></compnent>    
    <!-- breadcrumb end -->

    <!-- sub title + button start -->
    <div class="sub-tit-allwrap mb10">
	    <!-- title start -->
    	<div class="sub-tit">가맹점 메뉴 관리</div>
    </div>
    <!-- sub title + button end -->
     
	<!-- search filter box start -->
	<div class="display-between display-sm-between">
		<div class="col4-md col10-sm display-h-end">
			<span class="col2-sm w150px mb3">가맹점</span>
            <select class="form-control form-control-sm w300px col6-sm mr20" id="<@pageId>_storeList" onChange="<@pageId>.changeStore(this)">
            </select>                
			<span class="col2-sm w150px mb3">검색어</span>
			<input type="text" class="form-control form-control-sm mr5" id="searchValue" onEnter="<@pageId>.reload()">
			<button class="srch-btn" type="button" onclick="<@pageId>.reload()">검 색</button>
		</div>
		<div class="display-w-end col4 col4-md col10-sm mt10">
			<span class="col2-sm w120px txt-r mr10">Total : <span class="txt-red" id="<@pageId>_rowCnt"></span></span>
			&nbsp;&nbsp;<button class="flat-btn col2-sm" type="button" onclick="<@pageId>.openEdit()">편집</button>
		</div>
	</div>
	<!-- search filter box end --> 

    <!-- table area start -->
	<div class="tb-card-allwrap mt10">
		<div class="card-inwrap">
			<div class="card-cnt-wrap">
				<div class="table-allwrap">
					<compnent id="storeMenuManageGrid"></compnent>
				</div>
			</div>
		</div>    
	</div>    
    <!-- table area end -->

</page-component>