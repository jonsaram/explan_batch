<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		excelUpload : function(){
			
			$("#<@pageId> #errorLog").hide();
			$("#<@pageId> #errorMsg").html("");
			$("#<@pageId> #sheetNum").html("");
			$("#<@pageId> #stopIdx").html("");

			C_COM.selectExcelUploadToTable(function(retData) {
				if(retData.state == "S") {
					C_POP.alert('Excel Upload에 성공하였습니다.');
				} else if(retData.state == "E") {
					$("#<@pageId> #errorLog").show();
					
					$("#<@pageId> #errorMsg").html(retData.msg);

					$("#<@pageId> #sheetNum").html(retData.sheetNum);
					
					$("#<@pageId> #stopIdx").html(retData.stopIdx);
					
					if(isValid(retData.dupleNum)) {
						$("#<@pageId> #errorMsg").append(":" + retData.dupleNum);
						
					}
					$('#<@pageId> #scrollwrap').scrollTop($('#<@pageId> #scrollwrap')[0].scrollHeight);
					C_POP.alert('오류가 발생하였습니다.\n\n하단에 오류 메시지를 확인하세요.');
				} else {
					dwrite(retData);
				}
			});				
		 }
		,templateUpload : function(targetCell, rowData) {
			console.log(rowData);
			
			var parm = {
					 GRP_FILE_ID 	: rowData.TABLE_NAME
					,OWNER_CD 		: 'EXCEL_TEMPLATE'
					,mode			: "M"
					,title			: "NA"
					,hideComponent	: "Y"		// 화면에 보여주지 않고 기능만 활용함.
					,templateId		: "<@pageId>"
				}
				
				C_COMP.import("folderFileMng", "component_compMultiFilemng", parm , function(fileList) {

					if( !isEmpty(fileList) ){
						const delFileIds = fileList.filter( obj => obj.CREATE_DATE != _.max(fileList.map( obj => obj.CREATE_DATE )) ).map( obj=>obj.FILE_ID );
						if(delFileIds.length > 0){
							var parm = {
									 queryId 		: "system.delFileMng"
									,requestParm	: { FILE_IDS : delFileIds}
							}
							let resultData = C_COM.requestQuery(parm);
						}
						<@pageId>.<@pageId>_editor.reload()
					}
				});				
			
			<@pageId>.folderFileMng.selectFile();						
		 }
	}
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function() {
		let sendParm = {
			gridParm : {
				 requestQuery 	: {
					  queryId		: "system.getExcelUploadTableList"
					 ,requestParm	: {}
				 }	
				,tableName		: "TBL_EXP_EXUPTBL"
				,columnMap 		: {
					 "TABLE_NAME" 	: { headerText : "Table명"			,align : "left"}
					,"COLUMN_LIST" 	: { headerText : "Column List"		,align : "left"}
					,"TBL_CMMT" 	: { headerText : "Table Comment"	,align : "left"}
					,"ORG_FILE_NM" 	: { headerText : "FIle Name"		,align : "left", noSave : "Y"}
					,"FILE_ID" 		: { headerText : "fileId", noSave : "Y", hidden : "Y"}
					,"UPLOAD" 		: { headerText : "Template Upload"	, width :"150px", noSave : "Y", columnType : "button", buttonNm : "Template Upload"	, buttonFn : <@pageId>.templateUpload 	}
				 }
				,columnConfig 		: {
					
					 onClickCell: function(column, rowData) {
						 if(column == "ORG_FILE_NM") {
				            C_POP.confirm('다운로드 받으시겠습니까?', function() {
				                C_COM.fileDownload(rowData.FILE_ID);
				                
				            });
						 }
					 }
					
				}				
				,primaryKeyList		: ["TABLE_NAME"								]
				,searchColumnList	: ["TABLE_NAME", "COLUMN_LIST", "TBL_CMMT"	]	// Table 지정인경우 적용
				,orderColumnList 	: ["TABLE_NAME"								]	// Table 지정인경우 적용
			 }
			,addButtonList : [
				{
					 title 		: "엑셀업로드"
					,onClick	: function() {
						<@pageId>.excelUpload();
					 }  
				}
			]
		}
		C_COMP.import("<@pageId>_editor", "component_compTableEditor",sendParm , function() {});		
	});
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
</script>
<page-component>
    <!-- table area start -->
	<compnent id="<@pageId>_editor"></compnent>    
    <!-- table area end -->
	<component id="folderFileMng"></component>                    
</page-component>