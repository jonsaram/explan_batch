<meta charset="utf-8">
<script type="text/javascript">
	var <@pageId> = {
		 stockList	: []
		,loadComponent : function(parm) {
			 
			<@pageId>.stockList = C_STOCK.getStockList();
			 
			let sendParm = {
				gridParm : {
					 tableDataList	: <@pageId>.stockList
					,columnMap 		: {
						 "STOCK_MST_ID" 	: { headerText : "지점매출ID"	, hidden : "Y"			}
						,"PRODUCT_NM" 		: { headerText : "상품명"  								}
						,"STOCK_RATE"		: { headerText : "재고율" 	 							}
						,"STOCK_ANALY"		: { headerText : "재고 상태" 							}
						,"AVG_QUANTITY" 	: { headerText : "적정재고량"	,hidden : "Y", dataType : "number"  	}
						,"nujukSumQt" 		: { headerText : "현재재고량"	,hidden : "Y", dataType : "number"	}
					 }
					,addColumnMap	: {
						noSort	: {
							 "STOCK_ANALY" 	: "Y"
						}
					 }
					,columnConfig		: {
						makeCellViewData	: {
							"STOCK_RATE"	: function(cellText, rowData) {
								if(isNumber(cellText)) 	cellText = cellText + "%";
								else					cellText = "";
								return cellText;
								
							 }
							,"STOCK_ANALY" 	: function(cellText, rowData) {
								let rate = Math.round(rowData.nujukSumQt / rowData.AVG_QUANTITY *1000 ) / 10;
								let eobj = C_STOCK.evaluationCriteriaOfStock(rate);
								
								if(isEmpty(eobj)) return "";
								
								let retStr = `<span style="color:${eobj.COLOR_CODE}"	>${eobj.EVALUATION}</span>`;
								return retStr;
							 }
							,"outQuantitySum" 	: function(cellText, rowData) {
								if(isEmpty(cellText) || !isNumber(cellText)) 	return cellText;
								else 											return addComma(toNumber(cellText, 2, "ceil"));
							 }
							,"nujukSumQt" 		: function(cellText, rowData) {
								if(isEmpty(cellText) || !isNumber(cellText)) 	return cellText;
								else 											return addComma(toNumber(cellText, 2, "ceil"));
							 }
						 }
						,columnTooltip : {
							STOCK_ANALY : "- 매입Data 점검필요\n1. 매입 Data가 매우 작거나, 없는 경우로 매입 Data의 누락 가능성이 있습니다.\n2. 공식적인 매입(입고)가 부족한 상태에서 매출(출고)가 발생한 경우로 사입을 의심해 볼 수 있습니다."
						}
					 }
					,primaryKeyList		: ["STOCK_MST_ID"]
					,searchColumnList	: ["PRODUCT_CD", "PRODUCT_NM"]	
					,orderColumnList 	: ["PRODUCT_NM"]				
					,searchWhereMap		: {"BRAND_ID" : G_VAL.session.BRAND_ID }
					,rowCntId			: "<@pageId>_rowCnt"
				 }
			}
			C_COMP.import("<@pageId>_Grid", "component_compGrid",sendParm , function(tableList) {
				<@pageId>.makeChart(tableList);
			});
			
			C_COMP.import("<@pageId>_toDoList", "component_dashboard_compTodoList", {}, function(data) {
			});
			
		 }
		,makeChart : function(tableList) {
			let categories 	= []
			let series		= []
			let dataList1	= []
			
			$.each(tableList, function(idx) {
				categories	.push(this.PRODUCT_NM	);				
				dataList1	.push(this.STOCK_RATE	);				
			});
			series.push({ name : "재고율(%)", data : dataList1});
			
	        Highcharts.chart("<@pageId>_chart", {
	            chart: {
	                 type: 'column'
	                ,height : "280px"
	            },
	            title: {
	                text: ''
	            },
	            xAxis: {
	                categories: categories
	            },
	            yAxis: {
	                title: {
	                    text: '재고율(%)'
	                }
	            },
	            series: series
	        });
		 }
		,_lineRateChart : function(container, categories, series) {
			_lineRateChart(container, categories, series);
		 }	
		,_barLineChart		: function (container, categories, series  ) {
			_barLineChart(container, categories, series );
	     }
		,_barLeftChart		: function (container, chartArray  ) {
			_barLeftChart(container, chartArray);
		 }
		,_1bar2LineChart 	: function (container, categories, series) {
			_1bar2LineChart(container, categories, series);
		 }
		,changeStore : function(storeId) {
			G_VAL.current.storeId = storeId;
			C_STOCK.makeStockOfDay({}, function() {
				<@pageId>.loadComponent();
			});
		 }
	}
	// Page Load가 완료된후 실행 된다.
	C_PM.onLoadPage("<@pageId>", function() {

		// 가맹점 Selectbox 설정	
		C_COM.getStoreList(G_VAL.session.BRAND_ID, function(selectList) {
			C_STOCK.makeStockOfDay({}, function() {
				<@pageId>.loadComponent();
			});
		}, true);
		
		C_WIDGET.init(function(widgetList) {

			let baseCompIdMap	= {}
			$.each(widgetList, function() {
				baseCompIdMap[this.COMP_ID] = this.TAB_TITLE;
			});
			let baseCompIdList 	= []
			$.each(baseCompIdMap, function(key, title) {
				baseCompIdList.push({baseCompId : key, tabTitle : title});
			});

			var rparm = {
				 targetId 	: "<@pageId>_widget"
				,list		: baseCompIdList
				,append		: "Y"
			}
			C_COM.renderHtml("<@pageId>", rparm);

			$.each(baseCompIdList, function() {
				let baseCompId = this.baseCompId;
				C_COMP.import(baseCompId, baseCompId,{tabTitle : this.tabTitle} , function() {});
				C_WIDGET.hideAllWidget(baseCompId);
				$(`#${baseCompId} div[wgtframe=${baseCompId}]`).addClass("col10");
				$(`#${baseCompId} div[wgtframe5=${baseCompId}]`).addClass("col5");
			});
		});
	});
	// History back으로 이동해왔을 경우 이루틴이 실행된다.
	C_HM.onReturn("<@pageId>", function(pageId, data) {

	});
	
</script>


<page-component>

	<!-- sub title + button start -->
	<div class="sub-tit-allwrap mt30 mb10">
	    <!-- title start -->
	    <div class="sub-tit">Dashboard</div>
	</div>
	<!-- sub title + button end -->
	
	<!---------------------------------- 컴포넌트 카피 + 대체 시작 영역 -------------------------------------->
	<!-- body-container start -->
	<div class="col10 decoline mt20"></div>
        <div class="sub-tit-allwrap mt10">
   	      <!-- title start -->
       	  <div class="sub-tit-lg">가맹점 재고 현황</div>
       	</div>
	<div>
	<div class="body-inwrap01 mt20" id="<@pageId>_widget">
	    <!-- card 03 start -->
	    
	    <div class="card-allwrap col33-gap col5-md col10-sm mb-md-25 mb-sm-25">
	        <div class="card-inwrap">
	        <div class="card-tit-wrap">
	            <div class="card-tit">현재 상품 재고율 Chart</div>
	        </div>
	        <div class="card-cnt-wrap">
	            <div class="table-allwrap tb-div-h pt20">
	            <!-- chart start -->
	            <div class="card-cnt-wrap">
					<div id="<@pageId>_chart" width="100%" height="100%"></div>	            
				</div>
	            <!-- chart end -->            
	            </div>
	        </div>
	        </div>
	    </div>
	    <!-- card 03 end -->
	    <!-- card 04 start -->
	    <div class="card-allwrap col33-gap col5-md col10-sm mb-md-25 mb-sm-25">
	        <div class="card-inwrap">
		        <div class="card-tit-wrap">
		            <div class="card-tit">현재 재고 상태 목록</div>
	            	<div>total : <span id="<@pageId>_rowCnt">100</span></div>
		            
		        </div>
		        <div class="card-cnt-wrap">
		            <div class="table-allwrap tb-div-h">
		            <!-- table start -->
		            <component id="<@pageId>_Grid"></component>
		            <!-- table end -->            
		            </div>
		        </div>
	        </div>
	    </div>
	    <!-- card 04 end -->
	    <!-- card 04 start -->
		<div class="card-allwrap col33-gap col5-md col10-sm mb-md-25 mb-sm-25">
			<component id="<@pageId>_toDoList"></component>
	    </div>
	    <!-- card 04 end -->
	</div>
	<script type="text/x-jsrender" id="<@pageId>_widget_template">
		{{for list}}
		<div class="col10 decoline mt30"></div>
	        <div class="sub-tit-allwrap mt10">
    	      <!-- title start -->
        	  <div class="sub-tit-lg">{{:tabTitle}}</div>
        	</div>
	    	<compnent id="{{:baseCompId}}"></compnent>
		{{/for}}
	</script>
	
	<!-- body-container start -->
  
  
</page-component>
